[{"filePath":"C:\\prasanth\\Projects\\axium\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\force-seed.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client');\r\nconst prisma = new PrismaClient();\r\n\r\nasync function main() {\r\n    console.log(\"Checking users...\");\r\n    const users = await prisma.user.findMany();\r\n    users.forEach(u => console.log(`User: ${u.username} | Pass: ${u.password}`));\r\n\r\n    if (users.length === 0) {\r\n        console.log(\"Seeding mock users...\");\r\n        await prisma.user.createMany({\r\n            data: [\r\n                { name: \"Admin User\", username: \"admin\", password: \"admin_password\", role: \"admin\" },\r\n                { name: \"Standard User\", username: \"user\", password: \"user_password\", role: \"user\" }\r\n            ]\r\n        });\r\n        console.log(\"Seed complete!\");\r\n\r\n        const newUsers = await prisma.user.findMany();\r\n        console.log(\"New users:\", newUsers);\r\n    }\r\n}\r\n\r\nmain()\r\n    .catch(e => console.error(e))\r\n    .finally(async () => {\r\n        await prisma.$disconnect()\r\n    });\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\read-template.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":25},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":51}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\r\nconst { PrismaClient } = require('@prisma/client');\r\nconst prisma = new PrismaClient();\r\n\r\nasync function main() {\r\n    const t = await prisma.template.findFirst();\r\n    if (t) {\r\n        fs.writeFileSync('template-debug.html', t.code);\r\n        fs.writeFileSync('template-fields.json', t.fields);\r\n    }\r\n}\r\n\r\nmain()\r\n    .catch(e => console.error(e))\r\n    .finally(async () => {\r\n        await prisma.$disconnect()\r\n    });\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\read-valuation.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":25},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":51}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\r\nconst { PrismaClient } = require('@prisma/client');\r\nconst prisma = new PrismaClient();\r\n\r\nasync function main() {\r\n    const v = await prisma.valuation.findFirst({ orderBy: { createdAt: 'desc' } });\r\n    fs.writeFileSync('val-debug.json', JSON.stringify(v, null, 2));\r\n}\r\n\r\nmain()\r\n    .catch(e => console.error(e))\r\n    .finally(async () => {\r\n        await prisma.$disconnect()\r\n    });\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\admin\\sectors\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\admin\\templates\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sectorName' is defined but never used.","line":7,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useData, SectorId } from \"@/lib/data-context\";\r\nimport { Code, FileText, CheckCircle, Save, Trash2, Eye, AlertCircle } from \"lucide-react\";\r\nimport { useState } from \"react\";\r\n\r\nconst DEFAULT_CODE = (sectorName: string) => `\r\n<div class=\"valuation-report-content\">\r\n  <div class=\"text-center mb-8\">\r\n    <h2 class=\"text-xl font-bold uppercase tracking-widest border-b-2 border-black inline-block pb-1\">Valuation Report</h2>\r\n  </div>\r\n\r\n  <table class=\"w-full border-collapse border-2 border-black mb-8\">\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"3\" class=\"bg-gray-100 border border-black px-4 py-2 text-left font-bold uppercase text-sm\">GENERAL INFORMATION</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center w-12\">1</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Name of the party/owner</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"text\" name=\"clientName\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Enter owner name\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">2</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Address of the property</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <textarea name=\"propertyAddress\" rows=\"2\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Enter full address\"></textarea>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">3</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Name/s of reported owner & registration details</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <textarea name=\"reportedOwner\" rows=\"2\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Registration details...\"></textarea>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">4</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Purpose of valuation</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"text\" name=\"valuationPurpose\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"e.g. Bank Loan\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">5</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">List of documents produced</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <textarea name=\"documentsProduced\" rows=\"2\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Documents...\"></textarea>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">6</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Date of inspection</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"date\" name=\"inspectionDate\" class=\"w-full border border-gray-300 rounded px-2 py-1\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">7</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Date of valuation</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"date\" name=\"valuationDate\" class=\"w-full border border-gray-300 rounded px-2 py-1\" required>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">8</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Distance from branch</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"text\" name=\"branchDistance\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"e.g. 5 km\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">9</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Situation/location description</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <textarea name=\"locationDescription\" rows=\"2\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Describe locality...\"></textarea>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">10</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Latitude & Longitude</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"text\" name=\"latLong\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"GPS coordinates\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">11</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold italic\">Valuation Amount ($)</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"number\" name=\"valuationAmount\" class=\"w-full border border-gray-300 rounded px-2 py-1 font-bold\" placeholder=\"0\" required>\r\n        </td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n`;\r\n\r\nexport default function TemplatesPage() {\r\n  const { sectors, templates, saveTemplate, deleteTemplate } = useData();\r\n  const [editing, setEditing] = useState<SectorId | null>(null);\r\n  const [code, setCode] = useState<string>(\"\");\r\n  const [previewMode, setPreviewMode] = useState(false);\r\n\r\n  const startEditing = (sectorId: SectorId, currentCode?: string, sectorName?: string) => {\r\n    setEditing(sectorId);\r\n    setCode(currentCode || DEFAULT_CODE(sectorName || \"Sector\"));\r\n    setPreviewMode(false);\r\n  };\r\n\r\n  const handleSave = (sectorId: SectorId) => {\r\n    // Extract field names from name=\"...\" or id=\"...\" attributes\r\n    const regex = /(?:name|id)=[\"']([^\"']+)[\"']/g;\r\n    const matches = [...code.matchAll(regex)];\r\n    const fields = [...new Set(matches.map(m => m[1]))];\r\n\r\n    // Check for inputs without name or id attributes\r\n    const hasUnnamedInputs = (code.match(/<input(?!.*(?:name|id)=)[^>]*>/g) || []).length > 0 ||\r\n      (code.match(/<textarea(?!.*(?:name|id)=)[^>]*>/g) || []).length > 0 ||\r\n      (code.match(/<select(?!.*(?:name|id)=)[^>]*>/g) || []).length > 0;\r\n\r\n    if (hasUnnamedInputs) {\r\n      if (!confirm(\"Warning: Some input fields appear to be missing 'name' attributes. Data entered in these fields will NOT be saved. Do you want to proceed anyway?\")) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (fields.length === 0 && !confirm(\"Warning: No named fields found. This template might not collect any data. Save anyway?\")) {\r\n      return;\r\n    }\r\n\r\n    saveTemplate(sectorId, code, fields);\r\n    alert(\"Saved!\");\r\n  };\r\n\r\n  const handleDelete = (sectorId: SectorId) => {\r\n    if (confirm(\"Are you sure you want to delete this template?\")) {\r\n      deleteTemplate(sectorId);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50/50 p-6 md:p-8\">\r\n      <div className=\"max-w-7xl mx-auto space-y-8\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold tracking-tight text-gray-900\">Templates</h1>\r\n          <p className=\"mt-2 text-gray-600\">\r\n            Create custom valuation forms using HTML, CSS, and JavaScript.\r\n          </p>\r\n        </div>\r\n\r\n        {editing && (\r\n          <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm\">\r\n            <div className=\"flex h-full w-full max-w-7xl flex-col overflow-hidden rounded-xl bg-white shadow-2xl ring-1 ring-gray-200\">\r\n              <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 bg-gray-50\">\r\n                <div className=\"flex items-center gap-4\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\r\n                    <Code className=\"h-5 w-5 text-indigo-600\" />\r\n                    Editing {sectors.find(s => s.id === editing)?.name}\r\n                  </h3>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    onClick={() => setPreviewMode(!previewMode)}\r\n                    className={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-2 ${previewMode\r\n                      ? \"bg-indigo-100 text-indigo-700\"\r\n                      : \"text-gray-600 hover:bg-gray-100\"\r\n                      }`}\r\n                  >\r\n                    <Eye className=\"h-4 w-4\" />\r\n                    {previewMode ? \"Edit Code\" : \"Preview\"}\r\n                  </button>\r\n                  <div className=\"h-6 w-px bg-gray-300 mx-1\" />\r\n                  <button\r\n                    onClick={() => setEditing(null)}\r\n                    className=\"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900\"\r\n                  >\r\n                    Close\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleSave(editing)}\r\n                    className=\"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md shadow-sm flex items-center gap-2\"\r\n                  >\r\n                    <Save className=\"h-4 w-4\" />\r\n                    Save\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex-1 overflow-hidden flex flex-col md:flex-row\">\r\n                {/* Code Editor */}\r\n                <div className={`flex-1 flex flex-col border-r border-gray-200 ${previewMode ? \"hidden md:flex md:w-1/2\" : \"w-full\"}`}>\r\n                  <div className=\"bg-gray-900 text-gray-400 text-xs px-4 py-2 border-b border-gray-800 font-mono flex items-center justify-between\">\r\n                    <span>HTML / CSS / JS Editor</span>\r\n                    <div className=\"flex gap-2\">\r\n                      <button\r\n                        onClick={() => setCode(prev => prev + '\\n<div class=\"form-group\">\\n  <label class=\"form-label\">New Field</label>\\n  <input type=\"text\" name=\"field_name\" class=\"form-input\">\\n</div>')}\r\n                        className=\"hover:text-white transition-colors\"\r\n                        title=\"Insert Text Input\"\r\n                      >\r\n                        + Input\r\n                      </button>\r\n                      <button\r\n                        onClick={() => setCode(prev => prev + '\\n<div class=\"form-group\">\\n  <label class=\"form-label\">New Area</label>\\n  <textarea name=\"area_name\" class=\"form-input\" rows=\"3\"></textarea>\\n</div>')}\r\n                        className=\"hover:text-white transition-colors\"\r\n                        title=\"Insert Text Area\"\r\n                      >\r\n                        + TextArea\r\n                      </button>\r\n                      <button\r\n                        onClick={() => setCode(prev => prev + '\\n<div class=\"form-group\">\\n  <label class=\"form-label\">New Date</label>\\n  <input type=\"date\" name=\"date_name\" class=\"form-input\">\\n</div>')}\r\n                        className=\"hover:text-white transition-colors\"\r\n                        title=\"Insert Date Input\"\r\n                      >\r\n                        + Date\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                  <textarea\r\n                    value={code}\r\n                    onChange={(e) => setCode(e.target.value)}\r\n                    className=\"flex-1 w-full bg-gray-900 text-green-400 font-mono text-sm p-4 resize-none focus:outline-none\"\r\n                    spellCheck={false}\r\n                    placeholder=\"Enter your HTML, CSS, and JS code here...\"\r\n                  />\r\n                  {/* Warning if no inputs or ids detected */}\r\n                  {!code.includes('name=') && !code.includes('id=') && code.length > 50 && (\r\n                    <div className=\"bg-yellow-900/20 text-yellow-500 text-xs px-4 py-2 border-t border-yellow-900/30 flex items-center gap-2\">\r\n                      <AlertCircle className=\"h-3 w-3\" />\r\n                      Warning: No named fields or IDs detected. Users won&apos;t be able to enter data that saves.\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Preview */}\r\n                <div className={`flex-1 flex flex-col bg-gray-50 ${!previewMode ? \"hidden md:flex md:w-1/2\" : \"w-full overflow-y-auto\"}`}>\r\n                  <div className=\"bg-white border-b border-gray-200 text-gray-500 text-xs px-4 py-2 relative\">\r\n                    Live Preview\r\n                  </div>\r\n                  <div className=\"p-8 flex-1 overflow-y-auto\">\r\n                    <div className=\"bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl p-6 relative\">\r\n                      {/* Note regarding script execution */}\r\n                      <div\r\n                        className=\"prose prose-sm max-w-none\"\r\n                        dangerouslySetInnerHTML={{ __html: code }}\r\n                      />\r\n                      <div className=\"mt-4 p-2 bg-yellow-50 text-yellow-700 text-xs rounded border border-yellow-200\">\r\n                        Note: Scripts may not execute in preview mode depending on browser security policies.\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\r\n          {sectors.map((sector) => {\r\n            const template = templates[sector.id];\r\n            return (\r\n              <div key={sector.id} className=\"relative group bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-all\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                  <div className=\"p-2 bg-indigo-50 rounded-lg text-indigo-600\">\r\n                    <FileText className=\"h-6 w-6\" />\r\n                  </div>\r\n                  {template && (\r\n                    <div className=\"flex items-center gap-1 text-green-600 bg-green-50 px-2 py-1 rounded-full text-xs font-medium\">\r\n                      <CheckCircle className=\"h-3 w-3\" />\r\n                      <span>Active</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-1\">{sector.name}</h3>\r\n                <p className=\"text-sm text-gray-500 mb-4 h-10 line-clamp-2\">\r\n                  {template\r\n                    ? `Last updated on ${template.uploadDate} `\r\n                    : \"No template configured yet.\"}\r\n                </p>\r\n\r\n                <div className=\"flex items-center justify-between pt-4 border-t border-gray-100\">\r\n                  <div className=\"text-xs text-gray-400 font-mono\">\r\n                    {template?.fields.length || 0} fields\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {template && (\r\n                      <button\r\n                        onClick={() => handleDelete(sector.id)}\r\n                        className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-md transition-colors\"\r\n                        title=\"Delete Template\"\r\n                      >\r\n                        <Trash2 className=\"h-4 w-4\" />\r\n                      </button>\r\n                    )}\r\n\r\n                    <button\r\n                      onClick={() => startEditing(sector.id, template?.code, sector.name)}\r\n                      className=\"inline-flex items-center gap-2 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 transition-all\"\r\n                    >\r\n                      <Code className=\"h-4 w-4 text-gray-500\" />\r\n                      {template ? \"Edit Code\" : \"Create Form\"}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\admin\\users\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRouter' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"useRouter"},"fix":{"range":[64,110],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1721,1724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1721,1724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":70,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":70,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3034,3037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3034,3037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3085,3088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3085,3088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3608,3611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3608,3611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":131,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":131,"endColumn":25}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useAuth } from \"@/lib/auth-context\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { Users, UserPlus, Shield, Key, X, Edit, Trash2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { getUsers, createUser, updateUser, deleteUser } from \"@/app/actions/db-actions\";\r\n\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { toast } from \"sonner\";\r\nimport { createUserSchema, updateUserSchema, CreateUserFormValues, UpdateUserFormValues } from \"@/lib/schemas\";\r\n\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { EmptyState } from \"@/components/ui/empty-state\";\r\nimport { PageWrapper } from \"@/components/ui/page-wrapper\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\n\r\ntype UserType = {\r\n    id: string;\r\n    name: string;\r\n    username: string;\r\n    role: string;\r\n    status: string;\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n};\r\n\r\nexport default function AdminUsersPage() {\r\n    const { user, isAuthenticated } = useAuth();\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    const [usersList, setUsersList] = useState<UserType[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    // Modal state\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [selectedUserId, setSelectedUserId] = useState<string | null>(null);\r\n\r\n    const { register, handleSubmit, reset, formState: { errors, isSubmitting } } = useForm<CreateUserFormValues | UpdateUserFormValues>({\r\n        resolver: zodResolver(isEditing ? updateUserSchema : createUserSchema) as any,\r\n        defaultValues: {\r\n            name: \"\",\r\n            username: \"\",\r\n            password: \"\",\r\n            role: \"user\",\r\n            status: \"active\"\r\n        }\r\n    });\r\n\r\n    const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n        if (isAuthenticated && user?.role === \"admin\") {\r\n            const delayDebounceFn = setTimeout(() => {\r\n                fetchUsers(searchTerm);\r\n            }, 500);\r\n            return () => clearTimeout(delayDebounceFn);\r\n        }\r\n    }, [isAuthenticated, user, searchTerm]);\r\n\r\n    const fetchUsers = async (search = \"\") => {\r\n        setIsLoading(true);\r\n        try {\r\n            const data = await getUsers(search);\r\n            setUsersList(data as UserType[]);\r\n        } catch (err) {\r\n            toast.error(\"Failed to fetch users\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleOpenModal = (userToEdit?: UserType) => {\r\n        if (userToEdit) {\r\n            setIsEditing(true);\r\n            setSelectedUserId(userToEdit.id);\r\n            reset({\r\n                name: userToEdit.name,\r\n                username: userToEdit.username,\r\n                password: \"\", // Leave blank, only update if typed\r\n                role: userToEdit.role as any,\r\n                status: userToEdit.status as any,\r\n            });\r\n        } else {\r\n            setIsEditing(false);\r\n            setSelectedUserId(null);\r\n            reset({\r\n                name: \"\",\r\n                username: \"\",\r\n                password: \"\",\r\n                role: \"user\",\r\n                status: \"active\"\r\n            });\r\n        }\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleCloseModal = () => {\r\n        setIsModalOpen(false);\r\n        setSelectedUserId(null);\r\n        reset();\r\n    };\r\n\r\n    const onSubmit = async (data: any) => {\r\n        try {\r\n            if (isEditing && selectedUserId) {\r\n                await updateUser(selectedUserId, data);\r\n                toast.success(\"User updated successfully\");\r\n            } else {\r\n                await createUser(data);\r\n                toast.success(\"User created successfully\");\r\n            }\r\n            await fetchUsers();\r\n            handleCloseModal();\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"An error occurred while saving the user.\");\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (id: string, name: string) => {\r\n        if (confirm(`Are you sure you want to delete user ${name}?`)) {\r\n            try {\r\n                await deleteUser(id);\r\n                toast.success(\"User deleted successfully\");\r\n                await fetchUsers();\r\n            } catch (err) {\r\n                toast.error(\"An error occurred while deleting the user.\");\r\n            }\r\n        }\r\n    };\r\n\r\n    if (!mounted || !user) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <PageWrapper className=\"space-y-6 relative\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold tracking-tight text-slate-900\">User Management</h1>\r\n                    <p className=\"text-slate-500 mt-1\">Manage system access and roles</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search users...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className=\"px-4 py-2 rounded-lg border border-slate-300 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-64\"\r\n                    />\r\n                    <button\r\n                        onClick={() => handleOpenModal()}\r\n                        className=\"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm shadow-indigo-500/20\"\r\n                    >\r\n                        <UserPlus className=\"w-4 h-4\" />\r\n                        Add User\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                <div className=\"bg-white rounded-xl border border-slate-200 p-6 shadow-sm\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-3 bg-indigo-50 text-indigo-600 rounded-lg\">\r\n                            <Users className=\"w-6 h-6\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-sm font-medium text-slate-500\">Total Users</p>\r\n                            <h3 className=\"text-2xl font-bold text-slate-900\">{usersList.length}</h3>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"bg-white rounded-xl border border-slate-200 p-6 shadow-sm\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-3 bg-emerald-50 text-emerald-600 rounded-lg\">\r\n                            <Shield className=\"w-6 h-6\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-sm font-medium text-slate-500\">Admins</p>\r\n                            <h3 className=\"text-2xl font-bold text-slate-900\">\r\n                                {usersList.filter(u => u.role === \"admin\").length}\r\n                            </h3>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"bg-white rounded-xl border border-slate-200 p-6 shadow-sm\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-3 bg-amber-50 text-amber-600 rounded-lg\">\r\n                            <Key className=\"w-6 h-6\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-sm font-medium text-slate-500\">Active Accounts</p>\r\n                            <h3 className=\"text-2xl font-bold text-slate-900\">\r\n                                {usersList.filter(u => u.status === \"active\").length}\r\n                            </h3>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\r\n                <div className=\"px-6 py-4 border-b border-slate-200 bg-slate-50/50\">\r\n                    <h2 className=\"text-lg font-semibold text-slate-900\">System Users</h2>\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-sm text-left\">\r\n                        <thead className=\"text-xs text-slate-500 bg-slate-50/50 uppercase border-b border-slate-200\">\r\n                            <tr>\r\n                                <th scope=\"col\" className=\"px-6 py-4 font-medium\">Name</th>\r\n                                <th scope=\"col\" className=\"px-6 py-4 font-medium\">Username</th>\r\n                                <th scope=\"col\" className=\"px-6 py-4 font-medium\">Role</th>\r\n                                <th scope=\"col\" className=\"px-6 py-4 font-medium\">Status</th>\r\n                                <th scope=\"col\" className=\"px-6 py-4 font-medium\">Joined</th>\r\n                                <th scope=\"col\" className=\"px-6 py-4 font-medium text-right\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-200\">\r\n                            {isLoading ? (\r\n                                Array.from({ length: 5 }).map((_, i) => (\r\n                                    <tr key={`skeleton-${i}`}>\r\n                                        <td className=\"px-6 py-4\"><div className=\"flex items-center gap-3\"><Skeleton className=\"h-8 w-8 rounded-full\" /><Skeleton className=\"h-4 w-24\" /></div></td>\r\n                                        <td className=\"px-6 py-4\"><Skeleton className=\"h-4 w-32\" /></td>\r\n                                        <td className=\"px-6 py-4\"><Skeleton className=\"h-5 w-16 rounded-full\" /></td>\r\n                                        <td className=\"px-6 py-4\"><Skeleton className=\"h-4 w-20\" /></td>\r\n                                        <td className=\"px-6 py-4\"><Skeleton className=\"h-4 w-24\" /></td>\r\n                                        <td className=\"px-6 py-4 text-right\"><Skeleton className=\"h-6 w-16 ml-auto\" /></td>\r\n                                    </tr>\r\n                                ))\r\n                            ) : usersList.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan={6} className=\"px-6 py-8\">\r\n                                        <EmptyState\r\n                                            title=\"No users found\"\r\n                                            description={searchTerm ? \"We couldn't find any users matching your search.\" : \"Get started by adding a new user to the system.\"}\r\n                                            icon={<Users className=\"w-6 h-6 text-indigo-400\" />}\r\n                                            className=\"border-none bg-transparent py-8\"\r\n                                            action={\r\n                                                !searchTerm && (\r\n                                                    <button\r\n                                                        onClick={() => handleOpenModal()}\r\n                                                        className=\"text-sm font-medium text-indigo-600 hover:text-indigo-700 hover:underline\"\r\n                                                    >\r\n                                                        Add your first user &rarr;\r\n                                                    </button>\r\n                                                )\r\n                                            }\r\n                                        />\r\n                                    </td>\r\n                                </tr>\r\n                            ) : (\r\n                                usersList.map((u) => (\r\n                                    <tr key={u.id} className=\"hover:bg-slate-50/50 transition-colors\">\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 font-medium text-xs\">\r\n                                                    {u.name.charAt(0).toUpperCase()}\r\n                                                </div>\r\n                                                <span className=\"font-medium text-slate-900\">{u.name}</span>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-slate-600\">\r\n                                            {u.username}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                            <span className={cn(\r\n                                                \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize\",\r\n                                                u.role === \"admin\" ? \"bg-indigo-50 text-indigo-700 ring-1 ring-inset ring-indigo-600/20\" : \"bg-slate-100 text-slate-700 ring-1 ring-inset ring-slate-600/20\"\r\n                                            )}>\r\n                                                {u.role}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                            <div className=\"flex items-center gap-1.5\">\r\n                                                <div className={cn(\r\n                                                    \"w-1.5 h-1.5 rounded-full\",\r\n                                                    u.status === \"active\" ? \"bg-emerald-500\" : \"bg-slate-300\"\r\n                                                )} />\r\n                                                <span className=\"text-slate-600 capitalize\">{u.status}</span>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-slate-500\">\r\n                                            {new Date(u.createdAt).toLocaleDateString()}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                                            <button\r\n                                                onClick={() => handleOpenModal(u)}\r\n                                                className=\"text-indigo-600 hover:text-indigo-900 mr-4 transition-colors p-1 rounded hover:bg-indigo-50\"\r\n                                                title=\"Edit User\"\r\n                                            >\r\n                                                <Edit className=\"w-4 h-4 inline\" />\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => handleDelete(u.id, u.name)}\r\n                                                className=\"text-red-600 hover:text-red-900 transition-colors p-1 rounded hover:bg-red-50\"\r\n                                                title=\"Delete User\"\r\n                                                disabled={u.username === user.username} // Prevent self-deletion\r\n                                            >\r\n                                                <Trash2 className={cn(\"w-4 h-4 inline\", u.username === user.username && \"opacity-50\")} />\r\n                                            </button>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Modal */}\r\n            <AnimatePresence>\r\n                {isModalOpen && (\r\n                    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0, scale: 0.95, y: 10 }}\r\n                            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                            exit={{ opacity: 0, scale: 0.95, y: 10 }}\r\n                            transition={{ duration: 0.2 }}\r\n                            className=\"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden ring-1 ring-slate-200\"\r\n                        >\r\n                            <div className=\"px-6 py-4 border-b border-slate-100 flex items-center justify-between\">\r\n                                <h3 className=\"text-lg font-bold text-slate-900\">\r\n                                    {isEditing ? \"Edit User\" : \"Add New User\"}\r\n                                </h3>\r\n                                <button type=\"button\" onClick={handleCloseModal} className=\"text-slate-400 hover:text-slate-600\">\r\n                                    <X className=\"w-5 h-5\" />\r\n                                </button>\r\n                            </div>\r\n                            <form onSubmit={handleSubmit(onSubmit)} className=\"p-6 space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-1\">Full Name</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        {...register(\"name\")}\r\n                                        className={cn(\"w-full rounded-lg border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\", errors.name ? \"border-red-500\" : \"border-slate-300\")}\r\n                                    />\r\n                                    {errors.name && <p className=\"text-xs text-red-500 mt-1\">{errors.name.message as string}</p>}\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-1\">Username</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        {...register(\"username\")}\r\n                                        className={cn(\"w-full rounded-lg border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\", errors.username ? \"border-red-500\" : \"border-slate-300\")}\r\n                                    />\r\n                                    {errors.username && <p className=\"text-xs text-red-500 mt-1\">{errors.username.message as string}</p>}\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-1\">\r\n                                        Password {isEditing && <span className=\"text-slate-400 font-normal\">(Leave blank to keep current)</span>}\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"password\"\r\n                                        {...register(\"password\")}\r\n                                        className={cn(\"w-full rounded-lg border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\", errors.password ? \"border-red-500\" : \"border-slate-300\")}\r\n                                        placeholder={isEditing ? \"••••••••\" : \"\"}\r\n                                    />\r\n                                    {errors.password && <p className=\"text-xs text-red-500 mt-1\">{errors.password.message as string}</p>}\r\n                                </div>\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Role</label>\r\n                                        <select\r\n                                            {...register(\"role\")}\r\n                                            className=\"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                                        >\r\n                                            <option value=\"user\">User</option>\r\n                                            <option value=\"admin\">Admin</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Status</label>\r\n                                        <select\r\n                                            {...register(\"status\")}\r\n                                            className=\"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                                        >\r\n                                            <option value=\"active\">Active</option>\r\n                                            <option value=\"inactive\">Inactive</option>\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"pt-4 flex gap-3 justify-end\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={handleCloseModal}\r\n                                        className=\"px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg transition-colors\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        disabled={isSubmitting}\r\n                                        className=\"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors disabled:opacity-50\"\r\n                                    >\r\n                                        {isSubmitting ? \"Saving...\" : \"Save User\"}\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n        </PageWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\valuation\\[sector]\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\valuation\\[sector]\\page.tsx:46:17\n  44 |             if (draft && draft.status === \"Pending\" && draft.sectorId === sector) {\n  45 |                 // eslint-disable-next-line react-hooks/set-state-in-effect\n> 46 |                 setFormData({\n     |                 ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  47 |                     clientName: draft.clientName,\n  48 |                     propertyAddress: draft.propertyAddress,\n  49 |                     valuationAmount: draft.valuationAmount ? draft.valuationAmount.toString() : \"\",","line":46,"column":17,"nodeType":null,"endLine":46,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\valuation\\report\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\valuation\\report\\[id]\\page.tsx:37:13\n  35 |                 dynamicData: valuation.dynamicData\n  36 |             });\n> 37 |             setMergedHtml(merged);\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  38 |         }\n  39 |     }, [template, valuation]);\n  40 |","line":37,"column":13,"nodeType":null,"endLine":37,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { use, useEffect, useState, useRef } from \"react\";\r\nimport { notFound, useRouter } from \"next/navigation\";\r\nimport { useData } from \"@/lib/data-context\";\r\nimport { mergeDataWithTemplate, downloadAsWord, REPORT_STYLES } from \"@/lib/report-generator\";\r\nimport { ChevronLeft, Printer, Download } from \"lucide-react\";\r\n\r\ninterface PageProps {\r\n    params: Promise<{ id: string }>;\r\n}\r\n\r\nexport default function ReportPage({ params }: PageProps) {\r\n    const { id } = use(params);\r\n    const { valuations, templates } = useData();\r\n    const router = useRouter();\r\n    const reportRef = useRef<HTMLDivElement>(null);\r\n\r\n    const valuation = valuations.find((v) => v.id === id);\r\n    if (!valuation) {\r\n        notFound();\r\n    }\r\n\r\n    const template = templates[valuation.sectorId];\r\n    const [mergedHtml, setMergedHtml] = useState<string>(\"\");\r\n\r\n    useEffect(() => {\r\n        if (template) {\r\n            const merged = mergeDataWithTemplate(template.code, {\r\n                clientName: valuation.clientName,\r\n                propertyAddress: valuation.propertyAddress,\r\n                valuationAmount: valuation.valuationAmount,\r\n                valuationDate: valuation.valuationDate,\r\n                notes: valuation.notes,\r\n                dynamicData: valuation.dynamicData\r\n            });\r\n            setMergedHtml(merged);\r\n        }\r\n    }, [template, valuation]);\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50/50\">\r\n            {/* Toolbar - Glassmorphism */}\r\n            <div className=\"sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-slate-200/60 px-4 py-3 print:hidden shadow-sm\">\r\n                <div className=\"max-w-7xl mx-auto flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <button\r\n                            onClick={() => router.back()}\r\n                            className=\"p-2 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-xl transition-all\"\r\n                            title=\"Go Back\"\r\n                        >\r\n                            <ChevronLeft className=\"h-5 w-5\" />\r\n                        </button>\r\n                        <div className=\"h-8 w-[1px] bg-slate-200 hidden sm:block\" />\r\n                        <div>\r\n                            <h2 className=\"text-sm font-bold text-slate-900 leading-tight\">Valuation Report</h2>\r\n                            <p className=\"text-[11px] text-slate-400 font-bold uppercase tracking-wider mt-0.5\">{valuation.clientName}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <button\r\n                            onClick={() => downloadAsWord(mergedHtml, `Valuation_Report_${valuation.clientName}`)}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-white text-slate-700 font-bold text-xs rounded-xl shadow-sm ring-1 ring-slate-200 hover:ring-indigo-500/30 hover:bg-slate-50 transition-all font-sans\"\r\n                        >\r\n                            <Download className=\"h-4 w-4 text-indigo-500\" />\r\n                            Export Word\r\n                        </button>\r\n                        <button\r\n                            onClick={() => window.print()}\r\n                            className=\"flex items-center gap-2 px-5 py-2 bg-indigo-600 text-white font-bold text-xs rounded-xl shadow-lg shadow-indigo-500/20 hover:bg-indigo-700 hover:shadow-indigo-500/30 transition-all font-sans\"\r\n                        >\r\n                            <Printer className=\"h-4 w-4\" />\r\n                            Print / PDF\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content Area */}\r\n            <main className=\"max-w-[1000px] mx-auto py-10 px-4 sm:px-6 lg:px-8 print:p-0\">\r\n                <div className=\"bg-white shadow-xl shadow-slate-200/50 ring-1 ring-slate-200 rounded-2xl overflow-hidden print:shadow-none print:ring-0 print:m-0 print:rounded-none\">\r\n                    <div className=\"min-h-[29.7cm] p-8 sm:p-12 print:p-0 report-view-mode\">\r\n                        {template ? (\r\n                            <div\r\n                                ref={reportRef}\r\n                                className=\"valuation-report-content max-w-none\"\r\n                                dangerouslySetInnerHTML={{ __html: mergedHtml }}\r\n                            />\r\n                        ) : (\r\n                            <div className=\"valuation-report-content\">\r\n                                <div className=\"text-center mb-8\">\r\n                                    <h2 className=\"text-xl font-bold uppercase tracking-widest border-b-2 border-black inline-block pb-1\">Valuation Report</h2>\r\n                                </div>\r\n\r\n                                <table className=\"w-full border-collapse border-2 border-black mb-8\">\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <th colSpan={3} className=\"bg-gray-100 border border-black px-4 py-2 text-left font-bold uppercase text-sm\">GENERAL INFORMATION</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center w-12 text-sm\">1</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">Name of the party/owner</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.clientName}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">2</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">Address of the property</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.propertyAddress}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">3</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">Name/s of reported owner & registration details</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.dynamicData?.reportedOwner || \"N/A\"}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">4</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">Purpose of valuation</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.dynamicData?.valuationPurpose || \"N/A\"}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">5</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">List of documents produced</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.dynamicData?.documentsProduced || \"N/A\"}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">6</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">Date of inspection</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.dynamicData?.inspectionDate || \"N/A\"}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">7</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">Date of valuation</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.valuationDate}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">8</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">Distance from branch</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.dynamicData?.branchDistance || \"N/A\"}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">9</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">Situation/location description</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.dynamicData?.locationDescription || \"N/A\"}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">10</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold\">Latitude & Longitude</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm\">\r\n                                                {valuation.dynamicData?.latLong || \"N/A\"}\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <td className=\"border border-black px-4 py-2 text-center text-sm\">11</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-sm font-semibold italic\">Valuation Amount ($)</td>\r\n                                            <td className=\"border border-black px-4 py-2 text-lg font-bold\">\r\n                                                ${valuation.valuationAmount.toLocaleString()}\r\n                                            </td>\r\n                                        </tr>\r\n                                    </tbody>\r\n                                </table>\r\n\r\n                                {valuation.notes && (\r\n                                    <div className=\"mt-8\">\r\n                                        <h3 className=\"text-xs font-bold text-gray-400 uppercase tracking-widest mb-2\">Additional Remarks</h3>\r\n                                        <div className=\"text-sm text-gray-700 leading-relaxed border p-4 bg-gray-50/50 rounded-lg\">\r\n                                            {valuation.notes}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {valuation.dynamicData && Object.keys(valuation.dynamicData).length > 6 && (\r\n                                    <div className=\"mt-8 pt-8 border-t border-gray-200\">\r\n                                        <h3 className=\"text-xs font-bold text-gray-400 uppercase tracking-widest mb-4\">Other Details</h3>\r\n                                        <div className=\"grid grid-cols-2 gap-4\">\r\n                                            {Object.entries(valuation.dynamicData)\r\n                                                .filter(([key]) => !['valuationPurpose', 'inspectionDate'].includes(key))\r\n                                                .map(([key, value]) => (\r\n                                                    <div key={key} className=\"border-b border-gray-100 pb-2\">\r\n                                                        <dt className=\"text-[10px] font-bold text-gray-400 uppercase\">{key.replace(/([A-Z])/g, ' $1')}</dt>\r\n                                                        <dd className=\"text-sm text-gray-800 font-medium\">{value}</dd>\r\n                                                    </div>\r\n                                                ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </main>\r\n\r\n            <style>{REPORT_STYLES}</style>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\(protected)\\valuations\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\actions\\auth-actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\actions\\db-actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2747,2750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2747,2750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\";\r\n\r\nimport { db } from \"@/lib/db\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\n// --- Sector Actions ---\r\n\r\nexport async function getSectors() {\r\n  return await db.sector.findMany({\r\n    orderBy: { createdAt: \"asc\" },\r\n  });\r\n}\r\n\r\nexport async function createSector(id: string, name: string) {\r\n  const sector = await db.sector.create({\r\n    data: { id, name },\r\n  });\r\n  revalidatePath(\"/\");\r\n  return sector;\r\n}\r\n\r\nexport async function deleteSector(id: string) {\r\n  await db.sector.delete({\r\n    where: { id },\r\n  });\r\n  revalidatePath(\"/\");\r\n}\r\n\r\n// --- Valuation Actions ---\r\n\r\nexport async function getValuations() {\r\n  const vals = await db.valuation.findMany({\r\n    orderBy: { createdAt: \"desc\" },\r\n  });\r\n  return vals.map((v: unknown) => {\r\n    const val = v as { dynamicData: string | null };\r\n    return {\r\n      ...(v as object),\r\n      dynamicData: val.dynamicData ? JSON.parse(val.dynamicData) : {}\r\n    };\r\n  });\r\n}\r\n\r\nexport async function createValuation(data: {\r\n  sectorId: string;\r\n  clientName: string;\r\n  propertyAddress: string;\r\n  valuationAmount: number;\r\n  valuationDate: string;\r\n  status?: string;\r\n  notes?: string;\r\n  dynamicData?: object;\r\n}) {\r\n  const valuation = await db.valuation.create({\r\n    data: {\r\n      sectorId: data.sectorId,\r\n      clientName: data.clientName,\r\n      propertyAddress: data.propertyAddress,\r\n      valuationAmount: data.valuationAmount,\r\n      valuationDate: data.valuationDate,\r\n      notes: data.notes,\r\n      status: data.status || \"Pending\",\r\n      dynamicData: data.dynamicData ? JSON.stringify(data.dynamicData) : null,\r\n    },\r\n  });\r\n  revalidatePath(\"/\");\r\n  return valuation;\r\n}\r\n\r\nexport async function updateValuation(id: string, data: {\r\n  clientName: string;\r\n  propertyAddress: string;\r\n  valuationAmount: number;\r\n  valuationDate: string;\r\n  status?: string;\r\n  notes?: string;\r\n  dynamicData?: object;\r\n}) {\r\n  const valuation = await db.valuation.update({\r\n    where: { id },\r\n    data: {\r\n      clientName: data.clientName,\r\n      propertyAddress: data.propertyAddress,\r\n      valuationAmount: data.valuationAmount,\r\n      valuationDate: data.valuationDate,\r\n      notes: data.notes,\r\n      status: data.status || \"Pending\",\r\n      dynamicData: data.dynamicData ? JSON.stringify(data.dynamicData) : null,\r\n    },\r\n  });\r\n  revalidatePath(\"/\");\r\n  return valuation;\r\n}\r\n\r\nexport async function deleteValuation(id: string) {\r\n  await db.valuation.delete({\r\n    where: { id },\r\n  });\r\n  revalidatePath(\"/\");\r\n}\r\n\r\n// --- Template Actions ---\r\n\r\nexport async function getTemplates() {\r\n  const templates = await db.template.findMany();\r\n  // Convert array to Record<SectorId, Template> for context compatibility\r\n  const templateRecord: Record<string, any> = {\r\n    bank: null,\r\n    individual: null,\r\n    company: null,\r\n  };\r\n\r\n  templates.forEach((t: unknown) => {\r\n    const temp = t as { sectorId: string; fields: string };\r\n    templateRecord[temp.sectorId] = {\r\n      ...(t as object),\r\n      fields: JSON.parse(temp.fields),\r\n    };\r\n  });\r\n\r\n  return templateRecord;\r\n}\r\n\r\nexport async function saveTemplate(sectorId: string, code: string, fields: string[]) {\r\n  const template = await db.template.upsert({\r\n    where: { sectorId },\r\n    update: {\r\n      code,\r\n      fields: JSON.stringify(fields),\r\n    },\r\n    create: {\r\n      sectorId,\r\n      code,\r\n      fields: JSON.stringify(fields),\r\n    },\r\n  });\r\n  revalidatePath(\"/admin/templates\");\r\n  return template;\r\n}\r\n\r\nexport async function deleteTemplate(sectorId: string) {\r\n  await db.template.delete({\r\n    where: { sectorId },\r\n  });\r\n  revalidatePath(\"/admin/templates\");\r\n}\r\n\r\n// --- User Actions ---\r\nexport async function getUsers(search?: string) {\r\n  return await db.user.findMany({\r\n    where: search ? {\r\n      OR: [\r\n        { name: { contains: search } },\r\n        { username: { contains: search } }\r\n      ]\r\n    } : undefined,\r\n    orderBy: { createdAt: 'desc' },\r\n    take: 50, // Limit to 50 for performance\r\n  });\r\n}\r\n\r\nexport async function createUser(data: { name: string; username: string; password?: string; role: string; status: string }) {\r\n  const user = await db.user.create({\r\n    data: {\r\n      name: data.name,\r\n      username: data.username.toLowerCase(),\r\n      password: data.password || \"password123\", // Default password if none provided\r\n      role: data.role,\r\n      status: data.status,\r\n    }\r\n  });\r\n  revalidatePath(\"/admin/users\");\r\n  return user;\r\n}\r\n\r\nexport async function updateUser(id: string, data: { name: string; username: string; password?: string; role: string; status: string }) {\r\n  const updateData: Record<string, string> = {\r\n    name: data.name,\r\n    username: data.username.toLowerCase(),\r\n    role: data.role,\r\n    status: data.status,\r\n  };\r\n\r\n  if (data.password && data.password.trim() !== \"\") {\r\n    updateData.password = data.password;\r\n  }\r\n\r\n  const user = await db.user.update({\r\n    where: { id },\r\n    data: updateData,\r\n  });\r\n  revalidatePath(\"/admin/users\");\r\n  return user;\r\n}\r\n\r\nexport async function deleteUser(id: string) {\r\n  await db.user.delete({\r\n    where: { id },\r\n  });\r\n  revalidatePath(\"/admin/users\");\r\n}\r\n\r\nexport async function verifyUser(username: string, password: string) {\r\n  const cleanUsername = username.trim().toLowerCase();\r\n  const user = await db.user.findFirst({\r\n    where: { username: cleanUsername }\r\n  });\r\n\r\n  // In a real app, use bcrypt.compare here\r\n  if (user && user.password === password) {\r\n    return {\r\n      username: user.username,\r\n      role: user.role,\r\n    };\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// Used for mock setup initially\r\nexport async function seedInitialData() {\r\n  // Create default sectors if none exist\r\n  const sectorCount = await db.sector.count();\r\n  if (sectorCount === 0) {\r\n    await db.sector.createMany({\r\n      data: [\r\n        { id: \"bank\", name: \"Bank Valuation\" },\r\n        { id: \"individual\", name: \"Individual Valuation\" },\r\n        { id: \"company\", name: \"Company Valuation\" },\r\n      ],\r\n    });\r\n  }\r\n\r\n  // Create default templates for these sectors if they don't have one\r\n  const sectors = [\"bank\", \"individual\", \"company\"];\r\n  for (const sectorId of sectors) {\r\n    const template = await db.template.findUnique({ where: { sectorId } });\r\n    if (!template) {\r\n      const code = `\r\n<div class=\"valuation-report-content\">\r\n  <div class=\"text-center mb-8\">\r\n    <h2 class=\"text-xl font-bold uppercase tracking-widest border-b-2 border-black inline-block pb-1\">Valuation Report</h2>\r\n  </div>\r\n\r\n  <table class=\"w-full border-collapse border-2 border-black mb-8\">\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"3\" class=\"bg-gray-100 border border-black px-4 py-2 text-left font-bold uppercase text-sm\">GENERAL INFORMATION</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center w-12\">1</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Name of the party/owner</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"text\" name=\"clientName\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Enter owner name\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">2</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Address of the property</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <textarea name=\"propertyAddress\" rows=\"2\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Enter full address\"></textarea>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">3</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Name/s of reported owner & registration details</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <textarea name=\"reportedOwner\" rows=\"2\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Registration details...\"></textarea>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">4</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Purpose of valuation</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"text\" name=\"valuationPurpose\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"e.g. Bank Loan\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">5</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">List of documents produced</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <textarea name=\"documentsProduced\" rows=\"2\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Documents...\"></textarea>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">6</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Date of inspection</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"date\" name=\"inspectionDate\" class=\"w-full border border-gray-300 rounded px-2 py-1\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">7</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Date of valuation</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"date\" name=\"valuationDate\" class=\"w-full border border-gray-300 rounded px-2 py-1\" required>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">8</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Distance from branch</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"text\" name=\"branchDistance\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"e.g. 5 km\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">9</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Situation/location description</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <textarea name=\"locationDescription\" rows=\"2\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"Describe locality...\"></textarea>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">10</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold\">Latitude & Longitude</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"text\" name=\"latLong\" class=\"w-full border border-gray-300 rounded px-2 py-1\" placeholder=\"GPS coordinates\">\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"border border-black px-4 py-2 text-center\">11</td>\r\n        <td class=\"border border-black px-4 py-2 text-sm font-semibold italic\">Valuation Amount ($)</td>\r\n        <td class=\"border border-black px-4 py-2\">\r\n          <input type=\"number\" name=\"valuationAmount\" class=\"w-full border border-gray-300 rounded px-2 py-1 font-bold\" placeholder=\"0\" required>\r\n        </td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n`;\r\n      const fields = [\"clientName\", \"propertyAddress\", \"reportedOwner\", \"valuationPurpose\", \"documentsProduced\", \"inspectionDate\", \"valuationDate\", \"branchDistance\", \"locationDescription\", \"latLong\", \"valuationAmount\"];\r\n      await db.template.create({\r\n        data: {\r\n          sectorId,\r\n          code,\r\n          fields: JSON.stringify(fields)\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  // Create mock users for login if none exist\r\n  const userCount = await db.user.count();\r\n  if (userCount === 0) {\r\n    await db.user.createMany({\r\n      data: [\r\n        { name: \"Admin User\", username: \"admin\", password: \"admin_password\", role: \"admin\" },\r\n        { name: \"Standard User\", username: \"user\", password: \"user_password\", role: \"user\" }\r\n      ]\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[925,928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[925,928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Metadata } from \"next\";\nimport { Geist, Geist_Mono } from \"next/font/google\";\nimport \"./globals.css\";\nimport { AuthProvider } from \"@/lib/auth-context\";\nimport { DataProvider } from \"@/lib/data-context\";\n\nconst geistSans = Geist({\n  variable: \"--font-geist-sans\",\n  subsets: [\"latin\"],\n});\n\nconst geistMono = Geist_Mono({\n  variable: \"--font-geist-mono\",\n  subsets: [\"latin\"],\n});\n\nexport const metadata: Metadata = {\n  title: \"Create Next App\",\n  description: \"Generated by create next app\",\n};\n\nimport { getCurrentUser } from \"@/app/actions/auth-actions\";\n\nimport { Toaster } from \"sonner\";\n\nexport default async function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  const user = await getCurrentUser();\n\n  return (\n    <html lang=\"en\">\n      <body\n        className={`${geistSans.variable} ${geistMono.variable} antialiased`}\n      >\n        <AuthProvider initialUser={user as any}>\n          <DataProvider>{children}</DataProvider>\n        </AuthProvider>\n        <Toaster richColors position=\"top-right\" />\n      </body>\n    </html>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":45,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { useAuth } from \"@/lib/auth-context\";\r\nimport { loginSchema, LoginFormValues } from \"@/lib/schemas\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Lock, User } from \"lucide-react\";\r\nimport { loginAction } from \"@/app/actions/auth-actions\";\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function LoginPage() {\r\n    const { login } = useAuth();\r\n    const router = useRouter();\r\n    const [globalError, setGlobalError] = useState(\"\");\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const {\r\n        register,\r\n        handleSubmit,\r\n        formState: { errors },\r\n    } = useForm<LoginFormValues>({\r\n        resolver: zodResolver(loginSchema),\r\n        defaultValues: {\r\n            username: \"\",\r\n            password: \"\",\r\n        },\r\n    });\r\n\r\n    const onSubmit = async (data: LoginFormValues) => {\r\n        setGlobalError(\"\");\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            const result = await loginAction(data.username, data.password);\r\n\r\n            if (result.success && result.user) {\r\n                await login(result.user.username, result.user.role);\r\n                router.refresh(); // Ensure server components re-fetch session\r\n            } else {\r\n                setGlobalError(result.error || \"Invalid username or password.\");\r\n            }\r\n        } catch (error) {\r\n            setGlobalError(\"An error occurred during sign in.\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex min-h-screen items-center justify-center bg-[#f8fafc] px-4\">\r\n            <div className=\"w-full max-w-md space-y-8 rounded-2xl bg-white p-10 shadow-xl border border-slate-100\">\r\n                <div className=\"text-center\">\r\n                    <h2 className=\"text-3xl font-extrabold text-slate-900 tracking-tight\">\r\n                        Valuation System\r\n                    </h2>\r\n                    <p className=\"mt-2 text-sm text-slate-500\">\r\n                        Sign in to access your dashboard\r\n                    </p>\r\n                </div>\r\n\r\n                <form className=\"mt-8 space-y-6\" onSubmit={handleSubmit(onSubmit)}>\r\n                    <div className=\"space-y-4\">\r\n                        <Input\r\n                            id=\"username\"\r\n                            type=\"text\"\r\n                            placeholder=\"Username\"\r\n                            icon={<User className=\"h-5 w-5\" />}\r\n                            {...register(\"username\")}\r\n                            error={errors.username?.message}\r\n                            autoComplete=\"username\"\r\n                        />\r\n\r\n                        <Input\r\n                            id=\"password\"\r\n                            type=\"password\"\r\n                            placeholder=\"Password\"\r\n                            icon={<Lock className=\"h-5 w-5\" />}\r\n                            {...register(\"password\")}\r\n                            error={errors.password?.message}\r\n                            autoComplete=\"current-password\"\r\n                        />\r\n                    </div>\r\n\r\n                    {globalError && (\r\n                        <div className=\"p-3 bg-red-50 border border-red-100 rounded-lg\">\r\n                            <p className=\"text-sm text-red-600 text-center font-medium\">\r\n                                {globalError}\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n\r\n                    <Button\r\n                        type=\"submit\"\r\n                        className=\"w-full\"\r\n                        size=\"lg\"\r\n                        isLoading={isLoading}\r\n                    >\r\n                        Sign in\r\n                    </Button>\r\n\r\n                    <div className=\"text-center text-xs text-slate-400 font-medium\">\r\n                        Demo Credentials: admin/admin or user/user\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\components\\ui\\empty-state.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\components\\ui\\page-wrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\lib\\auth-context.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loginAction' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":21,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"loginAction"},"fix":{"range":[152,164],"text":""},"desc":"Remove unused variable \"loginAction\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { createContext, useContext, useState, ReactNode } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { loginAction, logoutAction } from \"@/app/actions/auth-actions\";\r\n\r\nexport type UserRole = \"admin\" | \"user\" | null;\r\n\r\nexport interface User {\r\n    username: string;\r\n    role: UserRole;\r\n}\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    login: (username: string, role: UserRole) => Promise<void>;\r\n    logout: () => Promise<void>;\r\n    isAuthenticated: boolean;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children, initialUser }: { children: ReactNode, initialUser: User | null }) {\r\n    const [user, setUser] = useState<User | null>(initialUser);\r\n    const router = useRouter();\r\n\r\n    const login = async (username: string, role: UserRole) => {\r\n        // Handled by loginAction now, just setting local state for immediate UI reflection\r\n        setUser({ username, role });\r\n        router.push(\"/dashboard\");\r\n    };\r\n\r\n    const logout = async () => {\r\n        setUser(null);\r\n        await logoutAction(); // Handles cookie deletion and redirect\r\n    };\r\n\r\n    const isAuthenticated = !!user;\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ user, login, logout, isAuthenticated }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useAuth() {\r\n    const context = useContext(AuthContext);\r\n    if (context === undefined) {\r\n        throw new Error(\"useAuth must be used within an AuthProvider\");\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\lib\\data-context.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'INITIAL_SECTORS' is assigned a value but never used.","line":53,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":53,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3081,3084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3081,3084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5416,5419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5416,5419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5472,5475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5472,5475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5520,5523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5520,5523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5822,5825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5822,5825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5907,5910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5907,5910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5954,5957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5954,5957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7661,7664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7661,7664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7717,7720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7717,7720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":212,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7769,7772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7769,7772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":213,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7817,7820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7817,7820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":214,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7878,7881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7878,7881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7939,7942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7939,7942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7981,7984],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7981,7984],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8043,8046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8043,8046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\r\n\r\nexport type SectorId = string;\r\n\r\nexport interface Sector {\r\n    id: SectorId;\r\n    name: string;\r\n}\r\n\r\nexport interface Template {\r\n    sectorId: SectorId;\r\n    fileName?: string;\r\n    code: string; // Single string for all HTML/CSS/JS\r\n    uploadDate: string;\r\n    fields: string[];\r\n}\r\n\r\nexport interface Valuation {\r\n    id: string;\r\n    sectorId: SectorId;\r\n    clientName: string;\r\n    propertyAddress: string;\r\n    valuationAmount: number;\r\n    valuationDate: string;\r\n    notes?: string;\r\n    dynamicData?: Record<string, string>; // Data for dynamic fields\r\n    submissionDate: string;\r\n    status: \"Pending\" | \"Completed\";\r\n}\r\n\r\ninterface DataContextType {\r\n    sectors: Sector[];\r\n    templates: Record<SectorId, Template | null>;\r\n    valuations: Valuation[];\r\n    uploadTemplate: (sectorId: SectorId, fileName: string, fields?: string[]) => void;\r\n    addValuation: (valuation: Omit<Valuation, \"id\" | \"submissionDate\">) => Valuation;\r\n    updateValuation: (id: string, valuation: Partial<Omit<Valuation, \"id\" | \"submissionDate\">>) => Valuation;\r\n    deleteValuation: (id: string) => void;\r\n    addSector: (name: string) => void;\r\n    updateSector: (id: SectorId, name: string) => void;\r\n    deleteSector: (id: SectorId) => void;\r\n    saveTemplate: (sectorId: SectorId, code: string, fields: string[]) => void;\r\n    // Legacy support might be removed or updated\r\n    saveTemplateHTML: (sectorId: SectorId, htmlContent: string, fields: string[]) => void;\r\n    deleteTemplate: (sectorId: SectorId) => void;\r\n    refreshData: () => Promise<void>;\r\n}\r\n\r\nconst DataContext = createContext<DataContextType | undefined>(undefined);\r\n\r\nconst INITIAL_SECTORS: Sector[] = [\r\n    { id: \"bank\", name: \"Bank Valuation\" },\r\n    { id: \"individual\", name: \"Individual Valuation\" },\r\n    { id: \"company\", name: \"Company Valuation\" },\r\n];\r\n\r\nexport function DataProvider({ children }: { children: ReactNode }) {\r\n    const [sectors, setSectors] = useState<Sector[]>([]);\r\n    const [templates, setTemplates] = useState<Record<SectorId, Template | null>>({\r\n        bank: null,\r\n        individual: null,\r\n        company: null,\r\n    });\r\n    const [valuations, setValuations] = useState<Valuation[]>([]);\r\n    const [isInitialized, setIsInitialized] = useState(false);\r\n\r\n    const loadInitialData = async () => {\r\n        try {\r\n            // We must import actions dynamically here or load them at the top\r\n            // But since Server Actions are just async functions, we can import them.\r\n            const { getSectors, getTemplates, getValuations, seedInitialData } = await import(\"@/app/actions/db-actions\");\r\n\r\n            await seedInitialData();\r\n\r\n            const [dbSectors, dbTemplates, dbValuations] = await Promise.all([\r\n                getSectors(),\r\n                getTemplates(),\r\n                getValuations()\r\n            ]);\r\n\r\n            setSectors(dbSectors);\r\n            setTemplates(dbTemplates);\r\n            setValuations(dbValuations as any); // Cast for simplicity since Prisma dates are precise\r\n        } catch (error) {\r\n            console.error(\"Failed to load initial data from DB\", error);\r\n        } finally {\r\n            setIsInitialized(true);\r\n        }\r\n    };\r\n\r\n    // Load data from Database on mount\r\n    useEffect(() => {\r\n        loadInitialData();\r\n    }, []);\r\n\r\n    const refreshData = async () => {\r\n        await loadInitialData();\r\n    };\r\n\r\n    const saveTemplate = async (sectorId: SectorId, code: string, fields: string[]) => {\r\n        const { saveTemplate: dbSaveTemplate } = await import(\"@/app/actions/db-actions\");\r\n\r\n        const existingFields = templates[sectorId]?.fields || [];\r\n        const allFields = [...new Set([...existingFields, ...fields])];\r\n\r\n        const saved = await dbSaveTemplate(sectorId, code, allFields);\r\n\r\n        setTemplates((prev) => ({\r\n            ...prev,\r\n            [sectorId]: {\r\n                ...saved,\r\n                fields: JSON.parse(saved.fields),\r\n                uploadDate: new Date().toLocaleDateString()\r\n            }\r\n        }));\r\n    };\r\n\r\n    // Legacy adapter\r\n    const saveTemplateHTML = async (sectorId: SectorId, htmlContent: string, fields: string[]) => {\r\n        await saveTemplate(sectorId, htmlContent, fields);\r\n    };\r\n\r\n    const deleteTemplate = async (sectorId: SectorId) => {\r\n        const { deleteTemplate: dbDeleteTemplate } = await import(\"@/app/actions/db-actions\");\r\n        await dbDeleteTemplate(sectorId);\r\n\r\n        setTemplates((prev) => ({\r\n            ...prev,\r\n            [sectorId]: null\r\n        }));\r\n    };\r\n\r\n    // Kept for backward compatibility if needed, but we might deprecate\r\n    const uploadTemplate = (sectorId: SectorId, fileName: string, fields: string[] = []) => {\r\n        const newTemplate: Template = {\r\n            sectorId,\r\n            fileName,\r\n            uploadDate: new Date().toLocaleDateString(),\r\n            code: '', // Empty placeholder\r\n            fields,\r\n        };\r\n        setTemplates((prev) => ({\r\n            ...prev,\r\n            [sectorId]: newTemplate,\r\n        }));\r\n    };\r\n\r\n    const addValuation = async (data: Omit<Valuation, \"id\" | \"submissionDate\">) => {\r\n        const { createValuation } = await import(\"@/app/actions/db-actions\");\r\n\r\n        const newValuation = await createValuation(data as any);\r\n        setValuations((prev) => [newValuation as any, ...prev]);\r\n        return newValuation as any;\r\n    };\r\n\r\n    const updateValuationContext = async (id: string, data: Partial<Omit<Valuation, \"id\" | \"submissionDate\">>) => {\r\n        const { updateValuation: dbUpdateValuation } = await import(\"@/app/actions/db-actions\");\r\n\r\n        const updatedValuation = await dbUpdateValuation(id, data as any);\r\n        setValuations(prev => prev.map(v => v.id === id ? updatedValuation as any : v));\r\n        return updatedValuation as any;\r\n    };\r\n\r\n    const deleteValuationContext = async (id: string) => {\r\n        const { deleteValuation: dbDeleteValuation } = await import(\"@/app/actions/db-actions\");\r\n\r\n        if (confirm(\"Are you sure you want to delete this valuation? This action cannot be undone.\")) {\r\n            await dbDeleteValuation(id);\r\n            setValuations(prev => prev.filter(v => v.id !== id));\r\n        }\r\n    };\r\n\r\n    const addSector = async (name: string) => {\r\n        const { createSector } = await import(\"@/app/actions/db-actions\");\r\n        const id = name.toLowerCase().replace(/\\s+/g, \"-\");\r\n\r\n        if (sectors.some(s => s.id === id)) {\r\n            alert(\"A sector with this name already exists.\");\r\n            return;\r\n        }\r\n\r\n        const newSector = await createSector(id, name);\r\n        setSectors(prev => [...prev, newSector]);\r\n    };\r\n\r\n    const updateSector = (id: SectorId, name: string) => {\r\n        // Mock update for now\r\n        setSectors(prev => prev.map(s => s.id === id ? { ...s, name } : s));\r\n    };\r\n\r\n    const deleteSector = async (id: SectorId) => {\r\n        const { deleteSector: dbDeleteSector } = await import(\"@/app/actions/db-actions\");\r\n\r\n        if (confirm(\"Are you sure? This will hide all valuations associated with this sector.\")) {\r\n            await dbDeleteSector(id);\r\n            setSectors(prev => prev.filter(s => s.id !== id));\r\n        }\r\n    };\r\n\r\n    // Prevent rendering children until hydration is complete to avoid mismatch\r\n    if (!isInitialized) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <DataContext.Provider value={{\r\n            sectors, templates, valuations,\r\n            uploadTemplate, saveTemplate: saveTemplate as any,\r\n            saveTemplateHTML: saveTemplateHTML as any,\r\n            deleteTemplate: deleteTemplate as any,\r\n            addValuation: addValuation as any,\r\n            updateValuation: updateValuationContext as any,\r\n            deleteValuation: deleteValuationContext as any,\r\n            addSector: addSector as any,\r\n            updateSector, deleteSector: deleteSector as any,\r\n            refreshData\r\n        }}>\r\n            {children}\r\n        </DataContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useData() {\r\n    const context = useContext(DataContext);\r\n    if (context === undefined) {\r\n        throw new Error(\"useData must be used within a DataProvider\");\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\lib\\db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\lib\\report-generator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\lib\\schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\lib\\session.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":29,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import \"server-only\";\r\nimport { SignJWT, jwtVerify } from \"jose\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UserRole } from \"./auth-context\";\r\n\r\nconst secretKey = process.env.SESSION_SECRET || \"super-secret-key-replace-in-production\";\r\nconst encodedKey = new TextEncoder().encode(secretKey);\r\n\r\nexport type SessionPayload = {\r\n    username: string;\r\n    role: UserRole;\r\n    expiresAt: Date;\r\n};\r\n\r\nexport async function encrypt(payload: SessionPayload) {\r\n    return new SignJWT(payload)\r\n        .setProtectedHeader({ alg: \"HS256\" })\r\n        .setIssuedAt()\r\n        .setExpirationTime(\"7d\")\r\n        .sign(encodedKey);\r\n}\r\n\r\nexport async function decrypt(session: string | undefined = \"\") {\r\n    try {\r\n        const { payload } = await jwtVerify(session, encodedKey, {\r\n            algorithms: [\"HS256\"],\r\n        });\r\n        return payload as SessionPayload;\r\n    } catch (error) {\r\n        return null; // Invalid token or expired\r\n    }\r\n}\r\n\r\nexport async function createSession(username: string, role: UserRole) {\r\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // 7 days\r\n    const sessionCookie = await encrypt({ username, role, expiresAt });\r\n\r\n    const cookieStore = await cookies();\r\n    cookieStore.set(\"session\", sessionCookie, {\r\n        httpOnly: true,\r\n        secure: process.env.NODE_ENV === \"production\",\r\n        expires: expiresAt,\r\n        sameSite: \"lax\",\r\n        path: \"/\",\r\n    });\r\n}\r\n\r\nexport async function updateSession() {\r\n    const cookieStore = await cookies();\r\n    const session = cookieStore.get(\"session\")?.value;\r\n    const payload = await decrypt(session);\r\n\r\n    if (!session || !payload) {\r\n        return null;\r\n    }\r\n\r\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\r\n    const refreshedCookie = await encrypt({ ...payload, expiresAt });\r\n\r\n    cookieStore.set(\"session\", refreshedCookie, {\r\n        httpOnly: true,\r\n        secure: process.env.NODE_ENV === \"production\",\r\n        expires: expiresAt,\r\n        sameSite: \"lax\",\r\n        path: \"/\",\r\n    });\r\n\r\n    return payload;\r\n}\r\n\r\nexport async function deleteSession() {\r\n    const cookieStore = await cookies();\r\n    cookieStore.delete(\"session\");\r\n}\r\n\r\nexport async function getSession() {\r\n    const cookieStore = await cookies();\r\n    const session = cookieStore.get(\"session\")?.value;\r\n    if (!session) return null;\r\n    return await decrypt(session);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\lib\\utils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\prasanth\\Projects\\axium\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]